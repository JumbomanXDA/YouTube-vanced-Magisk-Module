
# Detach script - Disable Play store updates for vanced YouTube
# Wait for 1 minute before executing detach script
sleep 60

# Expansion
PS=com.android.vending
LDB=/data/data/$PS/databases/library.db
LADB=/data/data/$PS/databases/localappstate.db
YT=com.google.android.youtube
PACKAGE=$(pm list packages | grep $YT | head -n 1 | cut -d ":" -f2-)

GET_LDB=$(sqlite3 $LDB "SELECT doc_type,doc_id FROM ownership" | grep $YT | head -n 1 | grep -o 25)
GET_LADB=$(sqlite3 $LADB "SELECT auto_update,package_name FROM appstate" | grep $YT | head -n 1 | grep -o 2)

# Main script
if [ "$PACKAGE" = "$YT" ]; then
	if [[ "$GET_LDB" != "25" || "$GET_LADB" != "2" ]]; then
		# Force Disable Play store
		pm disable $PS > /dev/null 2>&1
		
		# Update database
		sqlite3 $LDB "UPDATE ownership SET doc_type = '25' where doc_id = '$YT'"
		sqlite3 $LADB "UPDATE appstate SET auto_update = '2' where package_name = '$YT'"
		
		# Delete cache for play store
		rm -rf /data/data/$PS/cache/*
	
		# Re-enable Play store
		pm enable $PS > /dev/null 2>&1
	fi

	# Run crond demon on boot
	/data/adb/magisk/busybox crond -b -c /data/adb/modules/VancedYT/crontabs
fi
